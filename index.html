<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --stark-blue: #00e5ff; 
            --stark-dark: #001a23;
            --iron-red: #ff003c;
        }
        
        body { 
            background: #000; 
            color: var(--stark-blue); 
            margin: 0; 
            font-family: 'Orbitron', 'Courier New', monospace; 
            overflow: hidden; 
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Фоновая сетка как у Джарвиса */
        .grid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 229, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0, 229, 255, 0.05) 1px, transparent 1px);
            background-size: 30px 30px; pointer-events: none; z-index: -1;
        }

        /* Дуговой реактор MundoChat */
        .arc-reactor {
            width: 200px; height: 200px;
            position: relative;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.3s ease;
        }
        
        .arc-reactor:active { transform: scale(0.95); }

        .core {
            position: absolute; width: 60px; height: 60px;
            background: #fff; border-radius: 50%;
            box-shadow: 0 0 50px var(--stark-blue), 0 0 20px #fff;
            z-index: 10;
        }

        .ring {
            position: absolute; border: 4px solid var(--stark-blue);
            border-radius: 50%; animation: rotate 4s linear infinite;
            opacity: 0.7;
        }
        .ring-outer { width: 180px; height: 180px; border-style: double; border-width: 8px; }
        .ring-inner { width: 120px; height: 120px; border-style: dashed; animation-direction: reverse; }

        @keyframes rotate { 
            from { transform: rotate(0deg); } 
            to { transform: rotate(360deg); } 
        }

        /* Панель данных */
        .hud-panel {
            width: 90%; max-width: 400px;
            background: rgba(0, 26, 35, 0.8);
            border: 1px solid var(--stark-blue);
            border-radius: 15px; padding: 20px;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.2);
            margin-top: 40px; text-align: center;
        }

        .status-text { font-size: 10px; letter-spacing: 2px; margin-bottom: 10px; color: var(--stark-blue); }
        .console-output { height: 100px; overflow-y: auto; font-size: 13px; text-align: left; border-top: 1px solid rgba(0,229,255,0.3); padding-top: 10px; color: #fff; }

        .btn-stark {
            background: transparent; border: 1px solid var(--stark-blue);
            color: var(--stark-blue); padding: 12px 25px; margin-top: 20px;
            font-weight: bold; border-radius: 5px; width: 100%;
            text-transform: uppercase; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="grid-overlay"></div>

    <h1 style="font-size: 18px; margin-bottom: 30px; letter-spacing: 5px;">MUNDOCHAT OS</h1>

    <div class="arc-reactor" onclick="triggerScan()">
        <div class="core"></div>
        <div class="ring ring-outer"></div>
        <div class="ring ring-inner"></div>
    </div>

    <div class="hud-panel">
        <div class="status-text">NEURAL LINK: STANDBY</div>
        <div class="console-output" id="console">> Инициализация MundoChat...<br>> Ожидание голосовой команды...</div>
        <button class="btn-stark" onclick="activateAI(event)">Активировать протокол</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function triggerScan() {
            tg.HapticFeedback.impactOccurred('medium');
            logConsole("Сканирование биометрических данных...");
        }

        function logConsole(msg) {
            const console = document.getElementById('console');
            console.innerHTML += `<br>> ${msg}`;
            console.scrollTop = console.scrollHeight;
        }

        function activateAI(e) {
            e.stopPropagation();
            tg.HapticFeedback.notificationOccurred('success');
            
            document.querySelector('.core').style.background = '#00e5ff';
            logConsole("ПРОТОКОЛ 'MUNDO' АКТИВИРОВАН");
            
            const speech = new SpeechSynthesisUtterance("Mundo Chat active. I am ready to analyze your thoughts, Sir.");
            speech.lang = 'en-US';
            speech.rate = 1.0;
            window.speechSynthesis.speak(speech);

            setTimeout(() => {
                logConsole("Анализ вселенной завершен. Отчет сформирован.");
                sendToTelegram();
            }, 3000);
        }

        async function sendToTelegram() {
            const userId = tg.initDataUnsafe?.user?.id;
            try {
                await fetch('/api/report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message: "Анализ идеи в MundoChat завершен. Все системы в норме.", chatId: userId })
                });
                logConsole("ДАННЫЕ ПЕРЕДАНЫ В ВАШ ТЕРМИНАЛ.");
            } catch (err) {
                logConsole("ОШИБКА СВЯЗИ С БАЗОЙ.");
            }
        }
    </script>
</body>
</html>